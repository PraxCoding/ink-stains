# 数据库物理存储

> 在数据库系统的物理实现中，存储介质的层次结构是连接逻辑数据模型与实际数据持久化的关键桥梁，从高速缓存到归档磁带，每一层都在速度、成本与数据持久性的权衡中扮演着独特角色。

## 概述

<div align="center">
  <img src="assets/storage hierarchy.jpeg" height="400">
</div>

这是**存储设备层次结构示意图**，从上到下依次排列了存储设备：缓存→主存→闪存→磁碟→光盘→磁带，箭头表示数据在各层之间的传输方向。该图直观呈现了存储介质的层次结构、速度 - 成本的权衡关系，以及易失性的分布。

## 存储介质

**缓存**：速度最快但是成本最高，**容量最小**，由计算机硬件管理。数据库系统**不会**直接管理缓存，但是数据库实现者在设计查询处理的“数据结构与算法”时会考虑缓存的影响（如 B+ 树的节点大小通常会适配缓存块大小，4KB 或 8KB，使得在读取一个节点时，能一次性把整个节点的数据载入缓存，减少磁盘 I/O 次数）。

**主存**：用于存储 “可被通用机器指令直接操作的数据” 的存储介质。个人计算机的主存容量可达数十 GB，大型服务器系统甚至能达到数百到数千 GB；对于超大型数据库，主存通常因容量有限或成本过高无法存储整个数据库，但许多企业级数据库可容纳其中；不过，主存内容会因断电或系统崩溃丢失，具有**易失性（volatile）**，这一特性也决定了它无法作为超大型数据库的长期存储方案。

**闪存**：其每字节成本低于主存，但高于磁碟；断电后数据仍能保留，具有**非易失性**。在应用场景上，闪存广泛用于相机、手机的数据存储，也常见于 “USB 闪存盘”（俗称 “笔驱”），可通过计算机的通用串行总线（USB）接口使用。近年来，它还越来越多地替代个人电脑和服务器中的磁碟，以**固态硬盘**（SSD）的形式存在 。SSD 内部采用闪存存储数据，对外提供类似磁碟的块导向接口（数据以块为单位存储和检索，块大小通常在 512 字节到 8KB 之间）。

**磁碟存储**：数据**长期在线存储的主要介质**，通常称为**硬盘驱动器（HDD）**。它同样具备非易失性，能在断电或系统崩溃后保留数据，尽管磁盘偶尔会故障并破坏数据，但这种情况比系统崩溃或断电罕见得多。访问磁碟数据时，系统需先将数据从磁盘移到主存，才能对其操作；数据修改后，还需写回磁盘。

**光学存储**：DVD 是一种光学存储介质，通过激光光源进行数据的写入和读取。蓝光 DVD 格式的容量因支持的层数不同，在 27GB 到 128GB 之间。尽管 DVD 最初（且目前主要）用于存储视频数据，但它也能存储包括数据库内容备份在内的任何数字数据；不过，由于其数据访问时间远长于磁碟，因此**不适合存储 “活跃的数据库数据”**。从类型上看，部分 DVD 是只读的，在生产工厂阶段就完成数据写入；有些支持 “一次写入”，即可以写入一次但无法覆盖；还有些可多次重写。其中，仅能写入一次的磁盘被称为 “一次写入、多次读取（WORM，write-once, read-many）” 磁盘。

**磁带存储**：主要用于**低成本归档存储**和**大规模数据传输**。磁带的优势在于成本低于磁盘，且能安全存储数据多年；但它的**数据访问速度很慢**， 必须从磁带开头 “顺序访问” 数据，导致访问耗时可达数十到数百秒，因此被称为 “顺序访问存储”；而磁碟、SSD 属于 “直接访问存储”，可从磁盘任意位置读取数据。此外，磁带库（也称为自动换带机）可容纳大量磁带，实现无需人工干预的自动化存储与检索。

## 层次结构

1. 缓存和主存称为**主存储**（primary storage），属于易失性存储，断电或系统崩溃后数据会丢失；闪存和磁碟属于**辅助存储/在线存储**，磁带和光学磁盘自动换盘机是层次最低的介质，属于**三级存储/离线存储**，它们均属于非易失性存储，能长期保留数据，适合用于数据的安全保存。
2. 层次越高，存储介质成本越高但速度越快；沿层次向下，每比特成本降低，但访问时间增加。

## 配合机制

1. **效率**保障：数据库读写时，优先从缓存 / 主存获取数据；若缓存未命中，再从闪存 / 磁碟加载数据至主存 / 缓存，后续访问直接复用，提升效率。
2. **安全性**保障：主存 / 缓存中的数据需定期 “刷写” 至非易失性存储（如磁碟），避免断电丢失；数据库崩溃恢复时，从非易失性存储中读取最新数据，重建主存 / 缓存中的数据状态，确保数据一致性。

## 参考文献

```tex
{
  author = "Abraham Silberschatz, Henry F. Korth, S. Sudarshan",
  type = "Book",
  booktitle = "Database System Concepts (Seventh Edition)",
  chapter = "12.1 Overview of Physical Storage Media", 
  url = "https://www.db-book.com"
  publisher = "McGraw-Hill"
}
```

